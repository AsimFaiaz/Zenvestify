@inherits LayoutComponentBase
@inject NavigationManager Nav
@inject Zenvestify.Shared.Services.AuthService Auth
@using Zenvestify.Shared.Layout
@using Microsoft.AspNetCore.Components.Routing

<!-- Top header with logo (separate from sidebar) -->
<header class="site-header">
    <a href="/" class="brand brand--header" aria-label="Zenvestify">
        <img src="_content/Zenvestify.Shared/images/logos/logo-desktop.svg" alt="Zenvestify" />
    </a>
</header>

<!-- App shell sits BELOW the fixed header -->
<div class="app-shell">
    <aside class="app-sidebar">
        <nav class="nav">
            <a class="sidebar-link @(Nav.Uri.Contains("/dashboard") ? "active" : "")" href="/dashboard" title="Dashboard">
                <i class="bi bi-house"></i>
                <span class="label">Dashboard</span>
            </a>
              <a class="sidebar-link @(Nav.Uri.Contains("/income") ? "active" : "")" href="/income" title="Income">
                <i class="bi bi-money"></i>
                <span class="label">Income</span>
              </a>
            <a class="sidebar-link @(Nav.Uri.Contains("/tax") ? "active" : "")" href="/tax" title="Tax Centre">
                <i class="bi bi-percent"></i>
                <span class="label">Tax Centre</span>
            </a>
            <a class="sidebar-link @(Nav.Uri.Contains("/expenses") ? "active" : "")" href="/expenses" title="Expenses" >
                <i class="bi bi-cash-stack"></i>
                <span class="label">Expenses</span>
            </a>
            <a class="sidebar-link @(Nav.Uri.Contains("/bills") ? "active" : "")" href="/bills" title="Bills">
                <i class="bi bi-receipt"></i>
                <span class="label">Bills</span>
            </a>
            <a class="sidebar-link @(Nav.Uri.Contains("/savings") ? "active" : "")" href="/savings" title="Savings">
                <i class="bi bi-piggy-bank"></i>
                <span class="label">Savings</span>
            </a>
            <a class="sidebar-link @(Nav.Uri.Contains("/loans") ? "active" : "")" href="/loans" title="Loans">
                <i class="bi bi-bank"></i>
                <span class="label">Loans</span>
            </a>
            <a class="sidebar-link @(Nav.Uri.Contains("/reports") ? "active" : "")" href="/reports" title="Reports">
                <i class="bi bi-bar-chart"></i>
                <span class="label">Reports</span>
            </a>
            <a class="sidebar-link @(Nav.Uri.Contains("/settings") ? "active" : "")" href="/settings" title="Settings">
                <i class="bi bi-gear"></i>
                <span class="label">Settings</span>
            </a>
        </nav>

        <div class="mt-auto p-3">
            <button class="btn btn-outline-danger w-100" @onclick="HandleLogout">
                <i class="bi bi-box-arrow-right"></i> Logout
            </button>
        </div>
    </aside>

    <main class="app-main">
        <div class="container-fluid py-4">
            @Body
        </div>
    </main>

    @* chart.js *@
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

</div>

@code {
    protected override async Task OnInitializedAsync()
    {
        await Auth.LoadTokenAsync();
    }

    private async Task HandleLogout()
    {
        await Auth.LogoutAsync();
        Nav.NavigateTo("/", forceLoad: true);
    }

}